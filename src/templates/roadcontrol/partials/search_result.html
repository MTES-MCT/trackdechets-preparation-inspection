{% load static partials %}
{% partialdef bundle-form-partial %}
<form action="{% url "roadcontrol_pdf_bundle" %}" method="post">
    {% csrf_token %}
    {% for bsd in bsds %}
        <input type="hidden" name="siret" value="{{ search_params.siret }}" />
        <input type="hidden" name="plate" value="{{ search_params.plate }}" />
        <input type="hidden" name="bsd_types[]" value="{{ bsd.bsd_type }}" />
        <input type="hidden" name="bsd_ids[]" value="{{ bsd.id }}" />
        <input type="hidden" name="readable_ids[]" value="{{ bsd.readable_id }}" />
        <input type="hidden"
               name="waste_codes[]"
               value="{{ bsd.waste_details.code }}" />
        <input type="hidden" name="weights[]" value="{{ bsd.waste_details.weight }}" />
        <input type="hidden" name="adr_codes[]" value="{{ bsd.adr }}" />
        <input type="hidden" name="packagings[]" value="{{ bsd.packagings }}" />
    {% endfor %}
    <div class="fr-grid-row fr-grid-row--right">
        <button class="fr-btn fr-btn--secondary fr-btn--icon-right fr-icon-file-text-line">
            Exporter un dossier (zip) de tous les bordereaux
        </button>
    </div>
</form>
{% endpartialdef %}
{% if bsds %}
    <div>{% partial bundle-form-partial %}</div>
    <ul class="bsd-card-list">
        {% for bsd in bsds %}
            <li class="bsd-card-list__item">
                {% include "roadcontrol/partials/_bsd_card.html" with bsd=bsd search_params=search_params %}
            </li>
        {% endfor %}
    </ul>
    <div class="fr-mb-4w">{% partial bundle-form-partial %}</div>
{% else %}
    <div class="fr-alert fr-alert--warning fr-mt-4w">
        <h3 class="fr-alert__title">Aucun bordereau ne correspond aux crit√®res saisis</h3>
        {% for field in form %}
            {% if  field.errors %}
                <ul>
                    {% for error in field.errors %}
                        <li>
                            {{ field.label_tag }} <strong>{{ error|escape }}</strong>
                        </li>
                    {% endfor %}
                </ul>
            {% endif %}
        {% endfor %}
        <ul>
            {% for fn, value in form.cleaned_data.items %}<li>{{ fn }}: {{ value }}</li>{% endfor %}
        </ul>
    </div>
{% endif %}
